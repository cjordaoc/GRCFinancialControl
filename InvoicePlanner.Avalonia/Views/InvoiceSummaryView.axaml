
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:InvoicePlanner.Avalonia.ViewModels"
             xmlns:res="clr-namespace:InvoicePlanner.Avalonia.Resources"
             x:Class="InvoicePlanner.Avalonia.Views.InvoiceSummaryView"
             x:DataType="vm:InvoiceSummaryViewModel"
             mc:Ignorable="d">
    <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="12">
        <Border Grid.Row="0" Classes="Card" Padding="16" Margin="16,0,16,0">
            <StackPanel Spacing="12">
                <TextBlock Classes="TitleMedium" Text="{res:Loc Key=SummaryFiltersTitle}" />
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <StackPanel Spacing="4">
                        <TextBlock Text="{res:Loc Key=SummaryEngagementLabel}" />
                        <ComboBox ItemsSource="{Binding Engagements}"
                                  SelectedItem="{Binding SelectedEngagement, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayName}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Spacing="4">
                        <TextBlock Text="{res:Loc Key=SummaryCustomerLabel}" />
                        <ComboBox ItemsSource="{Binding Customers}"
                                  SelectedItem="{Binding SelectedCustomer, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayName}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                </Grid>
                <StackPanel Spacing="4">
                    <TextBlock Text="{res:Loc Key=SummaryStatusesLabel}" />
                    <ItemsControl ItemsSource="{Binding StatusFilters}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <CheckBox Content="{Binding DisplayName}"
                                          Margin="0,0,8,8"
                                          IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="{res:Loc Key=ButtonApplyFilters}" Command="{Binding RefreshCommand}" />
                    <Button Content="{res:Loc Key=ButtonClearFilters}" Command="{Binding ClearFiltersCommand}" />
                    <Button Content="{res:Loc Key=ButtonExportExcel}" Command="{Binding ExportExcelCommand}" />
                    <Button Content="{res:Loc Key=ButtonExportPdf}" Command="{Binding ExportPdfCommand}" />
                </StackPanel>
            </StackPanel>
        </Border>

        <Border Grid.Row="1" Classes="Card" Padding="16" Margin="16,0,16,0">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <StackPanel Spacing="4">
                    <TextBlock Text="{res:Loc Key=SummaryTotalsAmountLabel}" />
                    <TextBlock Classes="TitleMedium" Text="{Binding TotalAmount, StringFormat=Â¤\u00A0{0:N2}}" />
                </StackPanel>
                <StackPanel Grid.Column="1" Spacing="4">
                    <TextBlock Text="{res:Loc Key=SummaryTotalsPercentageLabel}" />
                    <TextBlock Classes="TitleMedium" Text="{Binding TotalPercentage, StringFormat={}{0:N4}%}" />
                </StackPanel>
            </Grid>
        </Border>

        <StackPanel Grid.Row="2" Margin="16,0" Spacing="4">
            <TextBlock Foreground="DarkGreen" Text="{Binding StatusMessage}" IsVisible="{Binding HasStatusMessage}" />
            <TextBlock Foreground="DarkRed" Text="{Binding ValidationMessage}" IsVisible="{Binding HasValidationMessage}" />
        </StackPanel>

        <ScrollViewer Grid.Row="3" Margin="16" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Groups}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:InvoiceSummaryGroupViewModel">
                        <Border Classes="Card" Padding="16" Margin="0,0,0,12">
                            <StackPanel Spacing="12">
                                <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                                    <TextBlock Classes="TitleMedium" Text="{Binding EngagementName}" />
                                    <TextBlock Text="{Binding CustomerName}" />
                                    <TextBlock Text="{Binding CustomerCode}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <TextBlock Text="{Binding TotalAmountDisplay}" />
                                    <TextBlock Text="{Binding TotalPercentageDisplay}" />
                                    <TextBlock Text="{Binding PlannedCountDisplay}" />
                                    <TextBlock Text="{Binding RequestedCountDisplay}" />
                                    <TextBlock Text="{Binding ClosedCountDisplay}" />
                                    <TextBlock Text="{Binding CanceledCountDisplay}" />
                                    <TextBlock Text="{Binding EmittedCountDisplay}" />
                                </StackPanel>
                                <DataGrid ItemsSource="{Binding Items}"
                                          AutoGenerateColumns="False"
                                          HeadersVisibility="All"
                                          GridLinesVisibility="Horizontal"
                                          IsReadOnly="True"
                                          x:CompileBindings="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnSequence}" Binding="{Binding Sequence}" Width="40" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnPlan}" Binding="{Binding PlanId}" Width="80" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnStatus}" Binding="{Binding StatusDisplay}" Width="100" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnType}" Binding="{Binding PlanType}" Width="100" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnPercent}" Binding="{Binding Percentage, StringFormat={}{0:N4}}" Width="90" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnAmount}" Binding="{Binding Amount, StringFormat={}{0:N2}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnBase}" Binding="{Binding BaseValue, StringFormat={}{0:N2}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnEmission}" Binding="{Binding EmissionDate, StringFormat={}{0:yyyy-MM-dd}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnDue}" Binding="{Binding DueDate, StringFormat={}{0:yyyy-MM-dd}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnRequest}" Binding="{Binding RequestDate, StringFormat={}{0:yyyy-MM-dd}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnEmitted}" Binding="{Binding EmittedAt, StringFormat={}{0:yyyy-MM-dd}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnBz}" Binding="{Binding BzCode}" Width="100" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnRitm}" Binding="{Binding RitmNumber}" Width="140" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnCanceled}" Binding="{Binding CanceledAt, StringFormat={}{0:yyyy-MM-dd}}" Width="120" />
                                        <DataGridTextColumn Header="{res:Loc Key=SummaryColumnCancelReason}" Binding="{Binding CancelReason}" Width="200" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
