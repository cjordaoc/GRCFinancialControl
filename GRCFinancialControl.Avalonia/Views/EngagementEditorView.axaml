<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:GRCFinancialControl.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="550"
             x:Class="GRCFinancialControl.Avalonia.Views.EngagementEditorView"
             x:Name="EngagementEditorRoot"
             x:DataType="vm:EngagementEditorViewModel">
    <Panel>
        <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                CornerRadius="8"/>

        <ScrollViewer>
            <StackPanel Spacing="10" Margin="20">
                <TextBlock Text="Engagement Details" FontSize="18" FontWeight="Bold"/>

                <Grid ColumnDefinitions="Auto,*,Auto,*"
                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                      Margin="0,10,0,0">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Engagement ID:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding EngagementId}" Margin="10,0,0,0"/>

                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Customer:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="0" Grid.Column="3"
                              ItemsSource="{Binding Customers}"
                              SelectedItem="{Binding SelectedCustomer}"
                              DisplayMemberBinding="{Binding DisplayName}"
                              Margin="10,0,0,0"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Description:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3" Text="{Binding Description}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Customer Key:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding CustomerKey}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="2" Grid.Column="2" Text="Currency:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="2" Grid.Column="3" Text="{Binding Currency}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Status:" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="3" Grid.Column="1"
                              ItemsSource="{Binding StatusOptions}"
                              SelectedItem="{Binding Status}"
                              Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="3" Grid.Column="2" Text="Status Text:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="3" Grid.Column="3" Text="{Binding StatusText}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Opening Margin:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding OpeningMargin}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="4" Grid.Column="2" Text="Opening Value:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="4" Grid.Column="3" Text="{Binding OpeningValue}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Opening Expenses:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding OpeningExpenses}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="5" Grid.Column="2" Text="Total Planned Hours:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="5" Grid.Column="3" Text="{Binding TotalPlannedHours}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="6" Grid.Column="0" Text="Initial Hours Budget:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding InitialHoursBudget}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="6" Grid.Column="2" Text="ETC-P Hours:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="6" Grid.Column="3" Text="{Binding EtcpHours}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="7" Grid.Column="0" Text="Value ETC-P:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="7" Grid.Column="1" Text="{Binding ValueEtcp}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="7" Grid.Column="2" Text="Expenses ETC-P:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="7" Grid.Column="3" Text="{Binding ExpensesEtcp}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="8" Grid.Column="0" Text="Margin % Budget:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="8" Grid.Column="1" Text="{Binding MarginPctBudget}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="8" Grid.Column="2" Text="Margin % ETC-P:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="8" Grid.Column="3" Text="{Binding MarginPctEtcp}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="9" Grid.Column="0" Text="ETC-P Age (Days):" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="9" Grid.Column="1" Text="{Binding EtcpAgeDays}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="9" Grid.Column="2" Text="Last Closing Period:" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="9" Grid.Column="3" Text="{Binding LastClosingPeriodId}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="10" Grid.Column="0" Text="Latest ETC Date:" VerticalAlignment="Center"/>
                    <DatePicker Grid.Row="10" Grid.Column="1" SelectedDate="{Binding LatestEtcDateOffset}" Margin="10,4,0,0"/>

                    <TextBlock Grid.Row="10" Grid.Column="2" Text="Next ETC Date:" VerticalAlignment="Center"/>
                    <DatePicker Grid.Row="10" Grid.Column="3" SelectedDate="{Binding NextEtcDateOffset}" Margin="10,4,0,0"/>
                </Grid>

                <TextBlock Text="PAPD Assignments" FontSize="16" FontWeight="Bold" Margin="0,20,0,5"/>
                <DataGrid ItemsSource="{Binding PapdAssignments}" AutoGenerateColumns="False" IsReadOnly="True" SelectionMode="Single" Height="150">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="PAPD" Binding="{Binding Papd.Name}" Width="*"/>
                    <DataGridTextColumn Header="Effective Date" Binding="{Binding EffectiveDate, StringFormat='yyyy-MM-dd'}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
                <TextBlock Text="Financial Evolution Data" FontSize="16" FontWeight="Bold" Margin="0,20,0,5"/>
                <DataGrid ItemsSource="{Binding FinancialEvolutionEntries}"
                          SelectedItem="{Binding SelectedFinancialEvolutionEntry}"
                          AutoGenerateColumns="False"
                          Height="200">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="Closing Period" Width="2*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:EngagementFinancialEvolutionEntryViewModel">
                                    <ComboBox ItemsSource="{Binding DataContext.ClosingPeriods, ElementName=EngagementEditorRoot}"
                                              SelectedItem="{Binding SelectedClosingPeriod}"
                                              DisplayMemberBinding="{Binding Name}"
                                              IsEnabled="{Binding CanEditClosingPeriod}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Closing Period ID" Binding="{Binding ClosingPeriodId, UpdateSourceTrigger=PropertyChanged}" Width="2*"/>
                        <DataGridTextColumn Header="Hours" Binding="{Binding Hours, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                        <DataGridTextColumn Header="Value" Binding="{Binding Value, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                        <DataGridTextColumn Header="Margin" Binding="{Binding Margin, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                        <DataGridTextColumn Header="Expenses" Binding="{Binding Expenses, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
                <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,5,0,0">
                    <Button Content="Add Period Data" Command="{Binding AddFinancialEvolutionEntryCommand}" Classes="accent"/>
                    <Button Content="Remove Selected" Command="{Binding RemoveFinancialEvolutionEntryCommand}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="5" HorizontalAlignment="Right" Margin="0,20,0,0">
                    <Button Content="Save" Command="{Binding SaveCommand}" Classes="accent"/>
                    <Button Content="Close" Command="{Binding CloseCommand}"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Panel>
</UserControl>